<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Employee Helpdesk Dashboard</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#254798", // Deep blue from the "Create New Ticket" button
            secondary: "#EFF3FC", // Light blue background for active nav item
            "background-light": "#F3F5FA", // Main content background
            "background-dark": "#0F172A", // Dark mode background
            "surface-light": "#FFFFFF", // White cards
            "surface-dark": "#1E293B", // Dark mode cards
            "text-main-light": "#111827",
            "text-main-dark": "#F9FAFB",
            "text-sub-light": "#6B7280",
            "text-sub-dark": "#9CA3AF",
          },
          fontFamily: {
            display: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "5px",
            'sm': "5px",
            'md': "5px",
            'lg': "5px",
            'xl': "5px",
            '2xl': "5px",
            '3xl': "5px",
          },
        },
      },
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>

<body
  class="bg-background-light dark:bg-background-dark text-text-main-light dark:text-text-main-dark h-screen overflow-hidden flex">
  <!-- Mobile Overlay -->
  <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden" onclick="toggleSidebar()">
  </div>

  <!-- Sidebar -->
  <aside id="sidebar"
    class="fixed md:relative w-64 bg-surface-light dark:bg-surface-dark border-r border-gray-200 dark:border-gray-700 flex flex-col justify-between flex-shrink-0 z-40 md:z-20 h-screen -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
    <div class="flex-1 flex flex-col">
      <div class="h-20 flex items-center px-6 border-b border-gray-100 dark:border-gray-700 flex-shrink-0">
        <div class="flex items-center gap-3 w-full justify-center">
          <img src="/assets/images/shubham-logo.png" alt="Shubham Logo" class="h-12 w-auto object-contain">
        </div>
      </div>
      <nav class="p-4 space-y-1 flex-1 overflow-y-auto">
        <a class="flex items-center px-4 py-3 bg-secondary dark:bg-blue-900/40 text-primary dark:text-blue-300 rounded-lg font-medium transition-colors"
          href="/">
          <span class="material-icons-outlined mr-3">home</span>
          Home
        </a>
        <a class="flex items-center px-4 py-3 text-text-sub-light dark:text-text-sub-dark hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg font-medium transition-colors"
          href="#" onclick="handleCreateTicketClick(event)">
          <span class="material-icons-outlined mr-3">add_box</span>
          Create Ticket
        </a>
        <a class="flex items-center px-4 py-3 text-text-sub-light dark:text-text-sub-dark hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg font-medium transition-colors"
          href="/check-status.html">
          <span class="material-icons-outlined mr-3">fact_check</span>
          Check Status
        </a>
        <div class="pt-4 pb-2">
          <div class="h-px bg-gray-200 dark:bg-gray-700 mx-2"></div>
        </div>
        <a class="flex items-center px-4 py-3 text-text-sub-light dark:text-text-sub-dark hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg font-medium transition-colors"
          href="/knowledge-base.html">
          <span class="material-icons-outlined mr-3">menu_book</span>
          Knowledge Base
        </a>
        <a class="flex items-center px-4 py-3 text-text-sub-light dark:text-text-sub-dark hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg font-medium transition-colors"
          href="/it-policy.html">
          <span class="material-icons-outlined mr-3">policy</span>
          IT Policy
        </a>
        <a class="flex items-center px-4 py-3 text-text-sub-light dark:text-text-sub-dark hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg font-medium transition-colors"
          href="/contact-support.html">
          <span class="material-icons-outlined mr-3">mail_outline</span>
          Contact Support
        </a>
      </nav>
    </div>
  </aside>
  <div class="flex-1 flex flex-col h-screen overflow-hidden relative">
    <header
      class="h-20 bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 md:px-8 flex-shrink-0 z-10">
      <div class="flex items-center gap-4">
        <!-- Hamburger Menu Button (Mobile Only) -->
        <button onclick="toggleSidebar()"
          class="md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
          <span class="material-icons-outlined text-gray-700 dark:text-gray-300">menu</span>
        </button>
        <div>
          <h1 class="text-lg font-bold text-gray-900 dark:text-white">Employee Portal</h1>
          <p class="text-xs text-text-sub-light dark:text-text-sub-dark hidden sm:block">Welcome back to your
            support dashboard</p>
        </div>
      </div>
      <div class="flex items-center space-x-6">

        <div class="flex items-center space-x-3">
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300 hidden sm:block" id="userName">Guest</span>
          <div onclick="toggleAuthModal()"
            class="h-9 w-9 bg-green-700 text-white rounded-full flex items-center justify-center text-sm font-medium shadow-sm cursor-pointer hover:ring-2 hover:ring-primary transition-all">
            <img id="userAvatar" src="https://ui-avatars.com/api/?name=Guest&background=10b981" alt="Avatar"
              class="rounded-full h-full w-full">
          </div>
        </div>
      </div>
    </header>
    <main class="flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-6 md:p-10">
      <div
        class="max-w-4xl mx-auto bg-surface-light dark:bg-surface-dark rounded-2xl shadow-sm p-8 md:p-16 text-center mb-6 relative overflow-hidden">
        <div
          class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-indigo-500 opacity-20 dark:opacity-40">
        </div>
        <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white mb-4 tracking-tight">
          How can we help you today?
        </h2>
        <p class="text-lg text-text-sub-light dark:text-text-sub-dark max-w-2xl mx-auto mb-10 leading-relaxed">
          Welcome to the Shubham EPC Employee Support. Submit a new request for IT & ERP Support or simply track your
          existing tickets.
        </p>
        <a href="#" onclick="handleCreateTicketClick(event)"
          class="bg-primary hover:bg-blue-800 text-white font-semibold py-3 px-8 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center mx-auto transform hover:-translate-y-0.5 w-fit">
          <span class="material-icons-outlined mr-2">add</span>
          Create New Ticket
        </a>
      </div>
      <div
        class="max-w-4xl mx-auto bg-surface-light dark:bg-surface-dark rounded-2xl shadow-sm p-8 md:px-12 md:py-10 flex flex-col md:flex-row items-center gap-8 mb-10">
        <div class="flex-1 text-center md:text-left">
          <div class="flex items-center justify-center md:justify-start mb-3">
            <span class="material-icons-outlined text-primary dark:text-blue-400 text-3xl mr-3">travel_explore</span>
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Check Ticket Status</h3>
          </div>
          <p class="text-text-sub-light dark:text-text-sub-dark leading-relaxed">
            Have a Ticket ID or Employee ID? Enter it below to see the latest updates on your requests
            without logging in.
          </p>
        </div>
        <div class="w-full md:w-auto flex-shrink-0">
          <form onsubmit="handleTrack(event)"
            class="bg-gray-50 dark:bg-gray-800/50 p-1.5 rounded-lg border border-gray-200 dark:border-gray-600 flex shadow-sm">
            <div class="flex items-center px-3">
              <span class="material-icons-outlined text-gray-400 dark:text-gray-500">badge</span>
            </div>
            <input id="trackInput"
              class="bg-transparent border-none focus:ring-0 text-gray-700 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 w-full md:w-64"
              placeholder="Enter Ticket ID / Employee ID" type="text" required />
            <button type="submit"
              class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-primary dark:text-blue-300 font-semibold px-5 py-2 rounded text-sm transition-colors flex items-center whitespace-nowrap">
              Track
              <span class="material-icons-outlined text-sm ml-1">arrow_forward</span>
            </button>
          </form>
          <div class="text-right mt-2">
            <a class="text-xs text-text-sub-light dark:text-text-sub-dark hover:text-primary dark:hover:text-blue-400 flex items-center justify-end transition-colors"
              href="/contact-support.html">
              Forgot your Ticket ID?
              <span class="material-icons-outlined text-[10px] ml-1">open_in_new</span>
            </a>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer
      class="bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 py-4 px-8 flex-shrink-0">
      <div
        class="flex flex-col md:flex-row items-center justify-between gap-2 text-sm text-text-sub-light dark:text-text-sub-dark">
        <div class="flex items-center gap-1">
          <span>Â© 2024</span>
          <span class="font-semibold text-gray-900 dark:text-white">Shubham EPC Pvt. Ltd.</span>
          <span>All rights reserved.</span>
        </div>

      </div>
    </footer>
  </div>

  <!-- Login/Signup Modal -->
  <div id="authModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
      <!-- Close Button -->
      <button onclick="toggleAuthModal()"
        class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
        <span class="material-icons-outlined">close</span>
      </button>

      <!-- Tabs -->
      <div id="authTabs" class="flex gap-4 mb-6 border-b border-gray-200 dark:border-gray-700">
        <button id="loginTab" onclick="switchAuthTab('login')"
          class="pb-3 px-4 font-semibold text-primary border-b-2 border-primary">
          Login
        </button>
        <button id="signupTab" onclick="switchAuthTab('signup')"
          class="pb-3 px-4 font-semibold text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          Sign Up
        </button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Welcome Back!</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Login with your Employee ID</p>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Employee ID</label>
          <input type="text" id="loginEmployeeId" required
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Mobile Number</label>
          <input type="tel" id="loginMobile" required pattern="[0-9]{10}"
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent"
            placeholder="10-digit mobile number">
        </div>

        <button type="submit" id="loginBtn"
          class="w-full bg-primary hover:bg-blue-800 text-white font-semibold py-3 rounded-lg transition-all">
          Login
        </button>
      </form>

      <!-- Signup Form -->
      <form id="signupForm" onsubmit="handleSignup(event)" class="space-y-4 hidden">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Create Account</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Register as a new employee</p>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Employee ID</label>
          <input type="text" id="signupEmployeeId" required
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
          <input type="text" id="signupName" required
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
          <input type="email" id="signupEmail" required
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Mobile Number</label>
          <input type="tel" id="signupMobile" required pattern="[0-9]{10}"
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent"
            placeholder="10-digit mobile number">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Department (Optional)</label>
          <input type="text" id="signupDepartment"
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <button type="submit" id="signupBtn"
          class="w-full bg-primary hover:bg-blue-800 text-white font-semibold py-3 rounded-lg transition-all">
          Sign Up
        </button>
      </form>

      <!-- Logout Button (shown when logged in) -->
      <button id="logoutBtn" onclick="handleLogout()"
        class="hidden w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-all mt-4">
        Logout
      </button>
    </div>
  </div>

  <script src="/shared/js/api.js"></script>
  <script src="/shared/js/chatbot.js"></script>
  <script>
    // Track Ticket Function
    function handleTrack(event) {
      event.preventDefault();
      const input = document.getElementById('trackInput').value.trim();
      if (input) {
        window.location.href = `/check-status.html?query=${input}`;
      }
    }

    // Handle Create Ticket Button Click
    function handleCreateTicketClick(event) {
      event.preventDefault();

      // Check if user is logged in
      const employee = getLoggedInEmployee();
      if (!employee) {
        alert('Please login to create a ticket');
        toggleAuthModal();
        return false;
      }

      // If logged in, navigate to create ticket page
      window.location.href = '/create-ticket.html';
    }

    // Auth Modal Functions
    function toggleAuthModal() {
      const modal = document.getElementById('authModal');
      modal.classList.toggle('hidden');

      // If user is logged in, show logout option
      const employee = getLoggedInEmployee();
      if (employee) {
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('signupForm').classList.add('hidden');
        document.getElementById('logoutBtn').classList.remove('hidden');
        document.querySelector('#authModal h2').textContent = `Hello, ${employee.name}!`;
        document.querySelector('#authModal p').textContent = `Employee ID: ${employee.employeeId}`;

        // Hide auth tabs explicitly
        const authTabs = document.getElementById('authTabs');
        if (authTabs) {
          authTabs.classList.add('hidden');
        }
      } else {
        // If not logged in, ensure login form is visible and logout is hidden
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('signupForm').classList.add('hidden');
        document.getElementById('logoutBtn').classList.add('hidden');
        document.querySelector('#authModal h2').textContent = `Welcome Back!`;
        document.querySelector('#authModal p').textContent = `Login with your Employee ID`;
        switchAuthTab('login'); // Ensure login tab is active

        // Show auth tabs when logged out
        const authTabs = document.getElementById('authTabs');
        if (authTabs) {
          authTabs.classList.remove('hidden');
        }
      }
    }

    function switchAuthTab(tab) {
      const loginTab = document.getElementById('loginTab');
      const signupTab = document.getElementById('signupTab');
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');

      if (tab === 'login') {
        loginTab.className = 'pb-3 px-4 font-semibold text-primary border-b-2 border-primary';
        signupTab.className = 'pb-3 px-4 font-semibold text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200';
        loginForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
      } else {
        signupTab.className = 'pb-3 px-4 font-semibold text-primary border-b-2 border-primary';
        loginTab.className = 'pb-3 px-4 font-semibold text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200';
        signupForm.classList.remove('hidden');
        loginForm.classList.add('hidden');
      }
    }

    // Employee Session Management
    function saveEmployeeSession(employee) {
      localStorage.setItem('employee', JSON.stringify(employee));
      updateUIForLoggedInUser(employee);
    }

    function getLoggedInEmployee() {
      const employee = localStorage.getItem('employee');
      return employee ? JSON.parse(employee) : null;
    }

    function clearEmployeeSession() {
      localStorage.removeItem('employee');
      updateUIForGuest();
    }

    function updateUIForLoggedInUser(employee) {
      document.getElementById('userName').textContent = employee.name;
      document.getElementById('userAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(employee.name)}&background=10b981`;
    }

    function updateUIForGuest() {
      document.getElementById('userName').textContent = 'Guest';
      document.getElementById('userAvatar').src = 'https://ui-avatars.com/api/?name=Guest&background=10b981';
    }

    // Handle Login
    async function handleLogin(event) {
      event.preventDefault();
      const btn = document.getElementById('loginBtn');
      const originalText = btn.textContent;

      try {
        btn.disabled = true;
        btn.textContent = 'Logging in...';

        const employeeId = document.getElementById('loginEmployeeId').value.trim();
        const mobile = document.getElementById('loginMobile').value.trim();

        const response = await EmployeeAuthAPI.login({ employeeId, mobile });

        if (response.success) {
          saveEmployeeSession(response.data);
          toggleAuthModal();
          alert('Login successful!');

          // Reset form
          document.getElementById('loginForm').reset();
        }
      } catch (error) {
        alert(error.message || 'Login failed. Please check your credentials.');
      } finally {
        btn.disabled = false;
        btn.textContent = originalText;
      }
    }

    // Initialize auth on page load
    function initializeAuth() {
      const employee = getLoggedInEmployee();
      if (employee) {
        updateUIForLoggedInUser(employee);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeAuth);
    } else {
      initializeAuth();
    }

    // Sidebar toggle for mobile
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');

      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function (event) {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const isClickInsideSidebar = sidebar.contains(event.target);
      const isHamburgerButton = event.target.closest('button[onclick="toggleSidebar()"]');

      if (!isClickInsideSidebar && !isHamburgerButton && !overlay.classList.contains('hidden')) {
        toggleSidebar();
      }
    });

    // Handle Signup
    async function handleSignup(event) {
      event.preventDefault();
      const btn = document.getElementById('signupBtn');
      const originalText = btn.textContent;

      try {
        btn.disabled = true;
        btn.textContent = 'Signing up...';

        const employeeData = {
          employeeId: document.getElementById('signupEmployeeId').value.trim(),
          name: document.getElementById('signupName').value.trim(),
          email: document.getElementById('signupEmail').value.trim(),
          mobile: document.getElementById('signupMobile').value.trim(),
          department: document.getElementById('signupDepartment').value.trim() || undefined
        };

        const response = await EmployeeAuthAPI.signup(employeeData);

        if (response.success) {
          alert('Registration successful! You can now login.');
          switchAuthTab('login');

          // Pre-fill login form
          document.getElementById('loginEmployeeId').value = employeeData.employeeId;
          document.getElementById('loginMobile').value = employeeData.mobile;

          // Reset signup form
          document.getElementById('signupForm').reset();
        }
      } catch (error) {
        alert(error.message || 'Signup failed. Please try again.');
      } finally {
        btn.disabled = false;
        btn.textContent = originalText;
      }
    }

    // Handle Logout
    function handleLogout() {
      if (confirm('Are you sure you want to logout?')) {
        // Clear entire local storage
        localStorage.clear();

        // Update UI immediately
        updateUIForGuest();

        // Force reload from server
        window.location.reload(true);
      }
    }


  </script>
</body>

</html>